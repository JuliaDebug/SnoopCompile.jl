<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Information for SnoopCompile developers · SnoopCompile</title><meta name="title" content="Information for SnoopCompile developers · SnoopCompile"/><meta property="og:title" content="Information for SnoopCompile developers · SnoopCompile"/><meta property="twitter:title" content="Information for SnoopCompile developers · SnoopCompile"/><meta name="description" content="Documentation for SnoopCompile."/><meta property="og:description" content="Documentation for SnoopCompile."/><meta property="twitter:description" content="Documentation for SnoopCompile."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SnoopCompile</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">SnoopCompile.jl</a></li><li><span class="tocitem">Basic tutorials</span><ul><li><a class="tocitem" href="../../tutorials/invalidations/">Tutorial on <code>@snoop_invalidations</code></a></li><li><a class="tocitem" href="../../tutorials/snoop_inference/">Tutorial on <code>@snoop_inference</code></a></li><li><a class="tocitem" href="../../tutorials/snoop_llvm/">Tutorial on <code>@snoop_llvm</code></a></li><li><a class="tocitem" href="../../tutorials/pgdsgui/">Profile-guided despecialization</a></li></ul></li><li><span class="tocitem">Advanced tutorials</span><ul><li><a class="tocitem" href="../../tutorials/snoop_inference_analysis/">Using <code>@snoop_inference</code> results to improve inferrability</a></li><li><a class="tocitem" href="../../tutorials/snoop_inference_parcel/">Using <code>@snoop_inference</code> to emit manual precompile directives</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../tools/">Package roles and alternatives</a></li><li><a class="tocitem" href="../gotchas/">Precompilation &quot;gotcha&quot;s</a></li><li><a class="tocitem" href="../fixing_inference/">Techniques for fixing inference problems</a></li><li><a class="tocitem" href="../invalidation_classes/">Invalidation classes</a></li><li class="is-active"><a class="tocitem" href>Information for SnoopCompile developers</a><ul class="internal"><li><a class="tocitem" href="#Invalidations"><span>Invalidations</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Explanations</a></li><li class="is-active"><a href>Information for SnoopCompile developers</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Information for SnoopCompile developers</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/JuliaDebug/SnoopCompile.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/JuliaDebug/SnoopCompile.jl/blob/master/docs/src/explanations/devs.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Information-for-SnoopCompile-developers"><a class="docs-heading-anchor" href="#Information-for-SnoopCompile-developers">Information for SnoopCompile developers</a><a id="Information-for-SnoopCompile-developers-1"></a><a class="docs-heading-anchor-permalink" href="#Information-for-SnoopCompile-developers" title="Permalink"></a></h1><h2 id="Invalidations"><a class="docs-heading-anchor" href="#Invalidations">Invalidations</a><a id="Invalidations-1"></a><a class="docs-heading-anchor-permalink" href="#Invalidations" title="Permalink"></a></h2><h3 id="Capturing-invalidation-logs"><a class="docs-heading-anchor" href="#Capturing-invalidation-logs">Capturing invalidation logs</a><a id="Capturing-invalidation-logs-1"></a><a class="docs-heading-anchor-permalink" href="#Capturing-invalidation-logs" title="Permalink"></a></h3><p>Julia itself handles (in)validation when you define (or delete) methods and load packages. Julia&#39;s internal machinery provides the option of recording these invalidation decisions to a log, which is just a <code>Vector{Any}</code>. Currently (as of Julia 1.12) there are two independent logs:</p><ul><li>for method insertion and deletion (i.e., new methods invalidating old code), logging is handled in Julia&#39;s <code>src/gf.c</code>. You enable it with <code>logmeths = ccall(:jl_debug_method_invalidation, Any, (Cint,), true)</code> and pass a final argument of <code>false</code> to turn it off.</li><li>for validating precompiled code during package loading (i.e., &quot;new&quot; code being invalidated by old methods), logging is handled in Julia&#39;s <code>base/staticdata.jl</code>. You enable it with <code>logedges = SnoopCompile.ReinferUtils.debug_method_invalidation(true)</code> and pass <code>false</code> to turn it off.</li></ul><p>In both cases, the log will initially be empty, but subsequent activity (defining or deleting methods, or loading packages) may add entries.</p><p>SnoopCompileCore&#39;s <code>@snoop_invalidation</code> just turns on these logging streams, executes the user&#39;s block of code, turns off logging, and returns the captured log streams.</p><h3 id="Interpreting-invalidation-logs"><a class="docs-heading-anchor" href="#Interpreting-invalidation-logs">Interpreting invalidation logs</a><a id="Interpreting-invalidation-logs-1"></a><a class="docs-heading-anchor-permalink" href="#Interpreting-invalidation-logs" title="Permalink"></a></h3><p>The definitive source for interpreting these two logging streams is Julia&#39;s own code; the documentation below may be outdated by future changes in Julia. (Such changes have happened repeatedly over the course of Julia&#39;s development.) If you have even a shred of doubt about whether any of this is (still) correct, check Julia&#39;s code.</p><p>For both logging streams, a single decision typically results in appending multiple entries to the log. These decisions come with a string (the <em>tag</em>) documenting the origin of each entry. In general, each distinct mechanism by which invalidations can occur should have its own unique tag. Often these correspond to specific lines in the source code.</p><h4 id="method-logs"><a class="docs-heading-anchor" href="#method-logs">method logs</a><a id="method-logs-1"></a><a class="docs-heading-anchor-permalink" href="#method-logs" title="Permalink"></a></h4><p>Let <code>trigger::Method</code> indicate an added or deleted method for function <code>f</code>. If defining/deleting this method would change how one or more <code>caller::MethodInstance</code>s of the corresponding function would dispatch, those <code>caller</code>s must be invalidated. Such events can result in a cascade of invalidations of code that directly or indirectly called <code>trigger</code> or less-specific methods of the same function. The order in which these invalidations appear in the log stream is as follows:</p><ol><li>Backedges of <code>callee</code> below, encoded as a tree where links are specified as <code>(caller::MethodInstance, depth::Int32)</code> pairs.</li></ol><p><code>depth=1</code> typically corresponds to an inferrable caller. <code>depth=0</code> corresponds to a potentially-missing callee (at the time of compilation), and will be followed by <code>calleesig::DataType</code>. (If the called function had potentially-applicable methods, <code>calleesig</code> will not be a subtype of any of their signatures.) corresponds to the root (though no entry with <code>depth=0</code> is written), and sequential increases in <code>depth</code> indicate a traversal through branches. If <code>depth</code> decreases, this indicates the start of a new branch from the parent with depth <code>depth-1</code>.</p><ol><li><code>(callee::MethodInstance, tag)</code> pairs that were directly affected by change in dispatch.</li><li>Possibly,</li></ol><p>After all such <code>callee</code> branches are complete, the <code>(trigger::Method, tag)</code> event that initiated the entire set of invalidations pair is logged.</p><p>The interpretation of the tags is as follows:</p><ul><li><code>&quot;jl_method_table_disable&quot;</code>: the <code>trigger</code> with the same tag was deleted (<code>Base.delete_method</code>)</li><li><code>&quot;jl_method_table_insert&quot;</code>: the <code>trigger</code> with the same tag was added (<code>function f(...) end</code>)</li><li><code>(callee::MethodInstance, &quot;invalidate_mt_cache&quot;)</code>: a method-table cache for runtime dispatch was invalidated by a method insertion. At sites of runtime dispatch, Julia will maintain local method tables of the most common call targets to make dispatch more efficient. Since runtime dispatch involves real-time method lookup anyway, this form of invalidation is not serious, and a detailed listing is suppressed by SnoopCompile&#39;s printing behavior. These are always followed (eventually) by a <code>(trigger::Method, &quot;jl_method_table_insert&quot;)</code> pair.</li></ul><h4 id="edge-logs"><a class="docs-heading-anchor" href="#edge-logs">edge logs</a><a id="edge-logs-1"></a><a class="docs-heading-anchor-permalink" href="#edge-logs" title="Permalink"></a></h4><p>Since edge logs are populated during package loading, we&#39;ll use <code>PkgDep</code> to indicate a package that is a dependency for <code>PkgUser</code>. (<code>PkgUser</code>&#39;s <code>Project.toml</code> might list <code>PkgDep</code> in its <code>[deps]</code> section, or it might be an indirect dependency.) Invalidation events result in the insertion of 3 or 4 items in <code>logedges</code>. The tag is always the second item. They take one of the following forms:</p><ul><li><code>(def::Method, &quot;method_globalref&quot;, codeinst::CodeInstance, nothing)</code>: method <code>def</code> in <code>PkgUser</code> references <code>PkgDep.SomeObject</code> (which might be <code>const</code> data, a type, etc.), but the binding for <code>SomeObject</code> has been modified since <code>PkgUser</code> was compiled. <code>codeinst</code>, which holds a compiled specialization of <code>def</code>, needs to be recompiled.</li><li><code>(edge::Union{MethodInstance,DataType,Core.Binding}, &quot;insert_backedges_callee&quot;, codeinst::CodeInstance, matches::Union{Vector{Any},Nothing})</code>: <code>edge</code> was selected as a dispatch target (a &quot;callee&quot;) of <code>codeinst</code>, but new method(s) listed in <code>matches</code> now supersede it in dispatch specificity. There are 3 or 4 sub-cases:<ul><li><code>edge::MethodInstance</code> indicates a known target at the time of compilation</li><li><code>edge::DataType</code> represents either<ul><li><code>Tuple{typeof(f), argtypes...}</code> for a poorly-inferred or <code>invoke</code>d call for which the target selected at compilation time is no longer valid (<code>matches</code> will be <code>nothing</code>)</li><li>a signature of a known function for which no appropriate method had yet been defined at the time of compilation. <code>matches</code> lists methods that now apply.</li></ul></li><li><code>edge::Core.Binding</code> indicates a target that was unknown at the time of compilation, and <code>matches</code> will be <code>nothing</code>.</li></ul></li><li><code>(caller::CodeInstance, &quot;verify_methods&quot;, callee::CodeInstance)</code>: <code>callee</code> is an invalidated dependency of <code>caller</code>. These encode invalidations that cascade from the proximal source.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../invalidation_classes/">« Invalidation classes</a><a class="docs-footer-nextpage" href="../../reference/">Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 25 September 2025 21:06">Thursday 25 September 2025</span>. Using Julia version 1.12.0-rc2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
