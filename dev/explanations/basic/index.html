<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Understanding SnoopCompile and Julia&#39;s compilation pipeline · SnoopCompile</title><meta name="title" content="Understanding SnoopCompile and Julia&#39;s compilation pipeline · SnoopCompile"/><meta property="og:title" content="Understanding SnoopCompile and Julia&#39;s compilation pipeline · SnoopCompile"/><meta property="twitter:title" content="Understanding SnoopCompile and Julia&#39;s compilation pipeline · SnoopCompile"/><meta name="description" content="Documentation for SnoopCompile."/><meta property="og:description" content="Documentation for SnoopCompile."/><meta property="twitter:description" content="Documentation for SnoopCompile."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">SnoopCompile</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">SnoopCompile.jl</a></li><li><span class="tocitem">Basic tutorials</span><ul><li><a class="tocitem" href="../../tutorials/invalidations/">Tutorial on <code>@snoop_invalidations</code></a></li><li><a class="tocitem" href="../../tutorials/snoop_inference/">Tutorial on <code>@snoop_inference</code></a></li><li><a class="tocitem" href="../../tutorials/snoop_llvm/">Tutorial on <code>@snoop_llvm</code></a></li><li><a class="tocitem" href="../../tutorials/pgdsgui/">Profile-guided despecialization</a></li><li><a class="tocitem" href="../../tutorials/jet/">Tutorial on JET integration</a></li></ul></li><li><span class="tocitem">Advanced tutorials</span><ul><li><a class="tocitem" href="../../tutorials/snoop_inference_analysis/">Using <code>@snoop_inference</code> results to improve inferrability</a></li><li><a class="tocitem" href="../../tutorials/snoop_inference_parcel/">Using <code>@snoop_inference</code> to emit manual precompile directives</a></li></ul></li><li><span class="tocitem">Explanations</span><ul><li><a class="tocitem" href="../tools/">Package roles and alternatives</a></li><li><a class="tocitem" href="../gotchas/">Precompilation &quot;gotcha&quot;s</a></li><li><a class="tocitem" href="../fixing_inference/">Techniques for fixing inference problems</a></li></ul></li><li><a class="tocitem" href="../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Understanding SnoopCompile and Julia&#39;s compilation pipeline</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Understanding SnoopCompile and Julia&#39;s compilation pipeline</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/timholy/SnoopCompile.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/timholy/SnoopCompile.jl/blob/master/docs/src/explanations/basic.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Understanding-SnoopCompile-and-Julia&#39;s-compilation-pipeline"><a class="docs-heading-anchor" href="#Understanding-SnoopCompile-and-Julia&#39;s-compilation-pipeline">Understanding SnoopCompile and Julia&#39;s compilation pipeline</a><a id="Understanding-SnoopCompile-and-Julia&#39;s-compilation-pipeline-1"></a><a class="docs-heading-anchor-permalink" href="#Understanding-SnoopCompile-and-Julia&#39;s-compilation-pipeline" title="Permalink"></a></h1><p>Julia uses <a href="https://en.wikipedia.org/wiki/Just-in-time_compilation">Just-in-time (JIT) compilation</a> to generate the code that runs on your CPU. Broadly speaking, there are two major compilation steps: <em>inference</em> and <em>code generation</em>. Inference is the process of determining the type of each object, which in turn determines which specific methods get called; once type inference is complete, code generation performs optimizations and ultimately generates the assembly language (native code) used on CPUs. Some aspects of this process are documented <a href="https://docs.julialang.org/en/v1/devdocs/eval/">here</a>.</p><p>Using code that has never been compiled requires that it first be JIT-compiled, and this contributes to the latency of using the package. In some circumstances, you can cache (store) the results of compilation to files to reduce the latency when your package is used. These files are the the <code>*.ji</code> and <code>*.so</code> files that live in the <code>compiled</code> directory of your Julia depot, usually located at <code>~/.julia/compiled</code>. However, if these files become large, loading them can be another source for latency. Julia needs time both to load and validate the cached compiled code. Minimizing the latency of using a package involves focusing on caching the compilation of code that is both commonly used and takes time to compile.</p><p>Caching code for later use is called <em>precompilation</em>. Julia has had some forms of precompilation almost since the very first packages. However, it was <a href="https://julialang.org/blog/2023/04/julia-1.9-highlights/#caching_of_native_code">Julia 1.9</a> that first supported &quot;complete&quot; precompilation, including the ability to store native code in shared-library cache files.</p><p>SnoopCompile is designed to try to allow you to analyze the costs of JIT-compilation, identify key bottlenecks that contribute to latency, and set up <code>precompile</code> directives to see whether it produces measurable benefits.</p><h2 id="Package-precompilation"><a class="docs-heading-anchor" href="#Package-precompilation">Package precompilation</a><a id="Package-precompilation-1"></a><a class="docs-heading-anchor-permalink" href="#Package-precompilation" title="Permalink"></a></h2><p>When a package is precompiled, here&#39;s what happens under the hood:</p><ul><li>Julia loads all of the package&#39;s dependencies (the ones in the <code>[deps]</code> section of the <code>Project.toml</code> file), typically from precompile cache files</li><li>Julia evaluates the source code (text files) that define the package module(s). Evaluating <code>function foo(args...) ... end</code> creates a new method <code>foo</code>. Note that:<ul><li>the source code might also contain statements that create &quot;data&quot; (e.g., <code>const</code>s). In some cases this can lead to some subtle precompilation <a href="../gotchas/#running-during-pc">&quot;gotchas&quot;</a></li><li>the source code might also contain a precompile workload, which forces compilation and tracking of package methods.</li></ul></li><li>Julia iterates over the module contents and writes the <em>result</em> to disk. Note that the module contents might include compiled code, and if so it is written along with everything else to the cache file.</li></ul><p>When Julia loads your package, it just loads the &quot;snapshot&quot; stored in the cache file: it does not re-evaluate the source-text files that defined your package! It is appropriate to think of the source files of your package as &quot;build scripts&quot; that create your module; once the &quot;build scripts&quot; are executed, it&#39;s the module itself that gets cached, and the job of the build scripts is done.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 21 October 2024 12:50">Monday 21 October 2024</span>. Using Julia version 1.11.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
